(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{373:function(t,s,a){"use strict";a.r(s);var e=a(45),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"创建项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[t._v("#")]),t._v(" 创建项目")]),t._v(" "),a("p",[t._v("查看 "),a("a",{attrs:{href:"https://nuxtjs.org/docs/2.x/get-started/installation",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1),t._v(" 或者 "),a("a",{attrs:{href:"https://www.nuxtjs.cn/guide/installation",target:"_blank",rel:"noopener noreferrer"}},[t._v("nuxt 中文网"),a("OutboundLink")],1),t._v(" 就可以了")]),t._v(" "),a("h2",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),a("h3",{attrs:{id:"首次部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#首次部署"}},[t._v("#")]),t._v(" 首次部署")]),t._v(" "),a("blockquote",[a("p",[t._v("参考文章")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000012774650",target:"_blank",rel:"noopener noreferrer"}},[t._v("next.js、nuxt.js等服务端渲染框架构建的项目部署到服务器，并用PM2守护程序"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000020452519?utm_source=tag-newest",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nuxt项目从开始到部署"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000014450967",target:"_blank",rel:"noopener noreferrer"}},[t._v("nuxt.js部署vue应用到服务端过程"),a("OutboundLink")],1)])])]),t._v(" "),a("blockquote",[a("p",[t._v("如果 Nginx 是运行在 docker 集群中的话，Nuxt 需要设置 hostname 为 0.0.0.0（所有地址）")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.nuxtjs.cn/faq/host-port",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何更改应用的主机和端口配置？"),a("OutboundLink")],1)])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("客户端 build 后，将 .nuxt  static nuxt.config.js package.json 上传至服务端指定目录下")]),t._v(" "),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://registry.npm.taobao.org // 也可以不使用淘宝镜像\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置 Nginx")]),t._v(" "),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("upstream nuxt-server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:3000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   keepalive "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   server_name xxx.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  // 域名\n   proxy_pass http://nuxt-server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  // 反向代理\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("配置好后需要重新加载 Nginx")]),t._v(" "),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it nginx "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" // 进入docker容器\nnginx -t // 检测配置语法是否通过\nnginx -s reload // 重新加载\n")])])])]),t._v(" "),a("li",[a("p",[t._v("使用 pm2 进程守护进行启动项目")]),t._v(" "),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(" pm2 start "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" --name "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nuxt-server"')]),t._v(" -- run start\n")])])])]),t._v(" "),a("li",[a("p",[t._v("在浏览器中输入你的域名")])])]),t._v(" "),a("blockquote",[a("p",[t._v("正常情况下，应该都可以正常访问的，如果出现 502 这些异常，就需要请后端帮忙解决下了。")])]),t._v(" "),a("h3",{attrs:{id:"再次部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#再次部署"}},[t._v("#")]),t._v(" 再次部署")]),t._v(" "),a("ol",[a("li",[t._v("上传文件")]),t._v(" "),a("li",[t._v("使用 pm2 重载进程"),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("pm2 list  // 查看当前运行的服务 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\npm2 reload "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" // 重载\npm2 restart "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" // 或者重启\n")])])]),t._v("或者重新启动"),a("div",{staticClass:"language-shell script extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(" pm2 stop "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" // 停止 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" 进程\n pm2 delete "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" // 删除 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" 进程\n pm2 start "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" --name "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nuxt-server"')]),t._v(" -- run start // 启动项目\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"问题集锦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题集锦"}},[t._v("#")]),t._v(" 问题集锦")]),t._v(" "),a("h3",{attrs:{id:"domexception-failed-to-execute-appendchild-on-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#domexception-failed-to-execute-appendchild-on-node"}},[t._v("#")]),t._v(" DOMException：Failed to execute 'appendChild' on 'Node'")]),t._v(" "),a("p",[t._v("本地调试出现以下警告")]),t._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('Parent: <div class="hot-view">...</div>\nMismatching childNodes vs.VNodes: ...\n')])])]),a("p",[t._v("并且在部署后报错（如图所示）\n"),a("img",{attrs:{src:"https://pic.downk.cc/item/5fed68d83ffa7d37b30739d5.png",alt:""}})]),t._v(" "),a("p",[t._v("解决方案：在 Parent 所提示的元素上用 client-only 包裹住即可解决s")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("client-only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hot-view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("..."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("client-only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h3",{attrs:{id:"the-client-side-rendered-virtual-dom-tree-is-not-matching-server-rendered-content"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-client-side-rendered-virtual-dom-tree-is-not-matching-server-rendered-content"}},[t._v("#")]),t._v(" The client-side rendered virtual DOM tree is not matching server-rendered content.")]),t._v(" "),a("p",[t._v("本地调试出现以下警告（如图所示）\n"),a("img",{attrs:{src:"https://pic.downk.cc/item/5ff7bec63ffa7d37b3bb60fe.png",alt:""}})]),t._v(" "),a("p",[t._v("这个错误还是挺难排查的，网上找了一圈，产生的原因有以下几个可能")]),t._v(" "),a("ul",[a("li",[t._v("不遵循 HTML 规范的写法")]),t._v(" "),a("li",[t._v("某个注释")]),t._v(" "),a("li",[t._v("JS 代码不规范")]),t._v(" "),a("li",[t._v("我遇到的是：store 下的 actions 里使用了 ||")])]),t._v(" "),a("p",[t._v("报错都一样，解决问题千差万别。那么如何排除问题呢？")]),t._v(" "),a("p",[t._v("很简单，首先，你得有个良好的代码版本管理习惯；")]),t._v(" "),a("p",[t._v("然后，回退版本到刚出现错误的版本，跟未出现错误的版本对比，增加了什么，逐一排查")]),t._v(" "),a("p",[t._v("就这么简单，且枯燥")]),t._v(" "),a("h3",{attrs:{id:"error-request-failed-with-status-code-404"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#error-request-failed-with-status-code-404"}},[t._v("#")]),t._v(" Error: Request failed with status code 404")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img.imgdb.cn/item/601e519a3ffa7d37b365814a.png",alt:""}}),t._v("\nNuxt 部署后，网站打开 node 服务就一直报这个错误，页面交互访问请求都毫无影响")]),t._v(" "),a("p",[t._v("不过这个会大量占用 CPU 资源，输出的日志不到几天就会几十个 G，非常消耗服务器资源")]),t._v(" "),a("p",[t._v("那么，究竟是什么原因导致的呢？通过穷举法不断排查，终于找到了（可累死我了）")]),t._v(" "),a("p",[t._v("原因是：在 layouts/default.vue 中的组件，如果在 created 生命周期内发起请求，就会报这个错误")]),t._v(" "),a("p",[t._v("解决方案："),a("strong",[t._v("把请求放到 mounted 中即可解决")])])])}),[],!1,null,null,null);s.default=n.exports}}]);